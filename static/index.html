<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/lmq8267/live2d-widget@master/autoload.js"></script>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ”—</text></svg>">
    <title>ç®€çŸ­åˆ†äº« - é•¿ç½‘å€ç¼©çŸ­ï¼Œæ–‡æœ¬åˆ†äº«ï¼ŒHtmlå•é¡µåˆ†äº«</title>
    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }
        .btn-secondary,
        .btn-secondary:hover,
        .btn-secondary:focus {
            color: #333;
            text-shadow: none;
        }
        .input-group-text {
            background-color: orange;
            border-color: orange;
        }
        .form-control {
            border-color: orange;
        }
        body {
            background-image: url('my-img.jpeg');
            background-size: cover;
            background-position: center;
            text-shadow: 0 .05rem .1rem rgba(0, 0, 0, .5);
        }
        .cover-container {
            max-width: 42em;
        }
        .navbar-brand svg {
            width: 30px;
            height: 30px;
        }
        @media (max-width: 576px) {
            #input-container .form-control,
            #input-container .input-group-text {
                display: block;
                width: 100%;
                margin-bottom: 1rem;
                border-radius: 5px;
            }
        }
        .footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
        }
        .footer .container {
            width: 100%;
            height: 100%;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .black-toast .toast {
            background-color: black;
        }
        .text-muted {
            font-size: 14px;
            color: #555;
            margin-right: 20px;
        }
        .form-check {
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .input-group-text {
            font-size: 14px;
        }
        .stat-box {
            display: inline-block;
            width: 150px;
            height: 100px;
            border: 1px solid #eee;
            border-radius: 10px;
            margin: 10px;
            text-align: center;
            padding: 10px;
            background-color: #f8f9fa;
        }
        .stat-box .stat-title {
            font-size: 18px;
            color: orange;
            font-weight: bold;
        }
        .stat-box .stat-value {
            font-size: 24px;
            color: orange;
            font-weight: bold;
        }
        /* Loading Overlay Styles */
        #loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            text-align: center;
        }
        #loading-text {
            color: orange;
            font-size: 24px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: scrollText 2s infinite;
        }
        @keyframes scrollText {
            0% {
                transform: translate(-50%, -50%) translateY(0);
            }
            50% {
                transform: translate(-50%, -50%) translateY(10px);
            }
            100% {
                transform: translate(-50%, -50%) translateY(0);
            }
        }
    </style>
    <script>
    (function () {
        var a_idx = 0;
        window.onclick = function (event) {
            var a = new Array("â¤å¯Œå¼ºâ¤", "â¤æ°‘ä¸»â¤", "â¤æ–‡æ˜â¤", "â¤å’Œè°â¤", "â¤è‡ªç”±â¤", "â¤å¹³ç­‰â¤", "â¤å…¬æ­£â¤", "â¤æ³•æ²»â¤", "â¤çˆ±å›½â¤",
                "â¤æ•¬ä¸šâ¤", "â¤è¯šä¿¡â¤", "â¤å‹å–„â¤");
 
            var heart = document.createElement("b"); //åˆ›å»ºbå…ƒç´ 
            heart.onselectstart = new Function('event.returnValue=false'); //é˜²æ­¢æ‹–åŠ¨
 
            document.body.appendChild(heart).innerHTML = a[a_idx]; //å°†bå…ƒç´ æ·»åŠ åˆ°é¡µé¢ä¸Š
            a_idx = (a_idx + 1) % a.length;
            heart.style.cssText = "position: fixed;left:-100%;"; //ç»™på…ƒç´ è®¾ç½®æ ·å¼
 
            var f = 2, // å­—ä½“å¤§å°
                x = event.clientX - f / 2, // æ¨ªåæ ‡
                y = event.clientY - f, // çºµåæ ‡
                c = randomColor(), // éšæœºé¢œè‰²
                a = 1, // é€æ˜åº¦
                s = 0.6; // æ”¾å¤§ç¼©å°
 
            var timer = setInterval(function () { //æ·»åŠ å®šæ—¶å™¨
                if (a <= 0) {
                    document.body.removeChild(heart);
                    clearInterval(timer);
                } else {
                    heart.style.cssText = "font-size:16px;cursor: default;position: fixed;color:" +
                        c + ";left:" + x + "px;top:" + y + "px;opacity:" + a + ";transform:scale(" +
                        s + ");";
 
                    y--;
                    a -= 0.016;
                    s += 0.002;
                }
            }, 15)
 
        }
        // éšæœºé¢œè‰²
        function randomColor() {
 
            return "rgb(" + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + "," + (~~(Math
                .random() * 255)) + ")";
 
        }
    }());
</script>
</head>
<body class="d-flex h-100 text-center text-white bg-dark">
<div id="loading-overlay">
    <div id="loading-text">ç”Ÿæˆä¸­...</div>
</div>
<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="mb-auto">
        <div>
        </div>
    </header>
    <main class="px-3">
        <h1>ç®€çŸ­åˆ†äº«</h1>
        <br>
        <br>
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div id="input-container">
                    <div class="input-group mb-3">
                        <label class="input-group-text" for="type">è¯·é€‰æ‹©åŠŸèƒ½</label>
                        <select class="form-select" id="type" name="type">
                            <option value="link">ç¼©çŸ­é“¾æ¥</option>
                            <option value="html">HTMLç½‘é¡µ</option>
                            <option value="text">txtæ–‡æœ¬</option>
                            <option value="page">ç½‘é¡µæ–‡æœ¬</option>
                            <option value="iframe">iframeç½‘é¡µ</option>
                        </select>
                    </div>

                    <div class="input-group mb-3">
                        <span class="input-group-text">è¯·è¾“å…¥åç¼€</span>
                        <input type="text" class="form-control" id="shortCode" placeholder="å¯é€‰ï¼Œç•™ç©ºéšæœºç”Ÿæˆåç¼€">
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text" title="âš ï¸è¯·åŠ¡å¿…ç‰¢è®°åç¼€å¯†ç ï¼Œå¿˜è®°å°†æ— æ³•ä¿®æ”¹ï¼Œåªèƒ½è”ç³»æ­¤ç«™é•¿åˆ é™¤ï¼">è¯·è®¾å®šå¯†ç </span>
                        <input type="text" class="form-control" id="password" placeholder="å¯é€‰ï¼Œå¯†ç ä¿æŠ¤åç¼€ï¼Œé˜²æ­¢ä»–äººä¿®æ”¹">
                    </div>

                    <div class="input-group mb-3">
                       <label class="input-group-text" for="expiration" title="âš ï¸è¿‡æœŸåå°†ä¼šè‡ªåŠ¨åˆ é™¤ï¼Œå¹¶é‡Šæ”¾åç¼€ï¼Œå…¶ä»–äººå°†å¯ä½¿ç”¨ï¼">æœ‰ æ•ˆ æ—¶ é•¿</label>
                       <select class="form-select" id="expiration" name="expiration" onchange="handleExpirationChange()">
                       <option value="">æ°¸ä¹…æœ‰æ•ˆ</option>
                       <option value="5">5åˆ†é’Ÿ</option>
                       <option value="10">10åˆ†é’Ÿ</option>
                       <option value="30">30åˆ†é’Ÿ</option>
                       <option value="60">1å°æ—¶</option>
                       <option value="600">10å°æ—¶</option>
                       <option value="1440" selected>1å¤©</option>
                       <option value="10080">1å‘¨</option>
                       <option value="43200">1ä¸ªæœˆ</option>
                       <option value="31536000">1å¹´</option>
                       <option value="custom">è‡ªå®šä¹‰</option>
                       </select>
                       <input type="number" class="form-control" id="expirationCustom" placeholder="è¯·è¾“å…¥åˆ†é’Ÿæ•°" style="display:none;">
                    </div>
                    <div>
                    </div>
                    <div class="input-group mb-3">
                        <label class="input-group-text" for="burn_after_reading" title="âš ï¸å¯ç”¨åæ‰“å¼€ä¸€æ¬¡å°†è‡ªåŠ¨åˆ é™¤ï¼Œå¹¶é‡Šæ”¾åç¼€ï¼Œå…¶ä»–äººå°†å¯ä½¿ç”¨ï¼">é˜… å å³ ç„š</label>
                        <select class="form-select" id="burn_after_reading">
                            <option value="false" selected>ä¸å¯ç”¨</option>
                            <option value="true">å¯ç”¨</option>
                        </select>
                    </div>
                    <div>
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text">è¯·è¾“å…¥å†…å®¹</span>
                        <textarea class="form-control" id="userInput" rows="5" placeholder="é•¿ç½‘å€æˆ–æ–‡æœ¬å†…å®¹æˆ–HTMLæºä»£ç "></textarea>
                    </div>
                    <button id="submit" class="btn btn-primary btn-block mt-3">ç”Ÿæˆ</button>
                </div>
                <div id="result" class="mt-3" style="display:none;">
                    <div class="alert alert-success">
                        <p class="lead">ç”ŸæˆæˆåŠŸï¼</p>
                        <p class="lead" id="shortUrl"></p>
                        
                        <button class="btn btn-success" onclick="openShortUrl()">æ‰“å¼€çŸ­é“¾æ¥</button>
                        <button class="btn btn-success" onclick="copyShortUrl()">å¤åˆ¶çŸ­é“¾æ¥</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <br><br><br>
    <footer class="mt-auto text-white-50">
        <div class="container text-center">
            <div class="stat-box">
                <div class="stat-title">åç¼€å·²ä½¿ç”¨</div>
                <div class="stat-value">{{totalRules}}</div>
            </div>
            <div class="stat-box">
                <div class="stat-title">ä»Šæ—¥ç”Ÿæˆæ•°</div>
                <div class="stat-value">{{todayNewRules}}</div>
            </div>
            <br>
            <div class="stat-box">
                <div class="stat-title">æ€»è½¬å€æ•°</div>
                <div class="stat-value">{{totalvisits}}</div>
            </div>
            <div class="stat-box">
                <div class="stat-title">ä»Šæ—¥è½¬å€æ•°</div>
                <div class="stat-value">{{todayvisits}}</div>
            </div>
        </div>
        <span class="text-muted">ç«™é•¿é‚®ç®±: ä¿®æ”¹ä¸ºä½ çš„é‚®ç®± </span>
    </footer>
</div>
<script>
    document.getElementById("submit").addEventListener("click", function () {
        var userInput = document.getElementById("userInput").value;
        var shortCode = document.getElementById("shortCode").value;
        var password = document.getElementById("password").value;
        var expirationSelect = document.getElementById("expiration");
        var expirationCustom = document.getElementById("expirationCustom");
        var burnAfterReading = document.getElementById("burn_after_reading").value;
        var type = document.getElementById("type").value;

        var expiration = expirationSelect.value === "custom" ? expirationCustom.value : expirationSelect.value;

        // Show loading overlay
        document.getElementById("loading-overlay").style.display = "block";
        document.body.style.overflow = "hidden"; // Prevent scrolling

        // Hide the result section when the button is clicked
        document.getElementById("result").style.display = "none";

        if (userInput === "") {
            alert("è¯·è¾“å…¥å†…å®¹ï¼");
            document.getElementById("loading-overlay").style.display = "none";
            document.body.style.overflow = "auto"; // Restore scrolling
            return;
        }

        fetch("/api", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                longUrl: userInput,
                shortCode: shortCode,
                password: password,
                expiration: expiration,
                burn_after_reading: burnAfterReading,
                type: type
            })
        }).then(response => response.json()).then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                var shortUrl = data.short_url;
                document.getElementById("shortUrl").innerText = shortUrl;
                document.getElementById("result").style.display = "block";
            }
            // Hide loading overlay
            document.getElementById("loading-overlay").style.display = "none";
            document.body.style.overflow = "auto"; // Restore scrolling
        }).catch(error => {
            console.error("Error:", error);
            // Hide loading overlay
            document.getElementById("loading-overlay").style.display = "none";
            document.body.style.overflow = "auto"; // Restore scrolling
        });
    });

    function handleExpirationChange() {
        var expirationSelect = document.getElementById("expiration");
        var expirationCustom = document.getElementById("expirationCustom");

        if (expirationSelect.value === "custom") {
            expirationCustom.style.display = "block";
            expirationCustom.disabled = false;
        } else {
            expirationCustom.style.display = "none";
            expirationCustom.disabled = true;
            expirationCustom.value = "";
        }
    }

    function copyShortUrl() {
            var shortUrl = document.getElementById("shortUrl").innerText;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shortUrl).then(() => {
                    alert("çŸ­é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                });
            } else {
                // Fallback for older browsers or non-HTTPS context
                var textArea = document.createElement("textarea");
                textArea.value = shortUrl;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert("çŸ­é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                }
                document.body.removeChild(textArea);
            }
        }
   function openShortUrl() {
        var shortUrl = document.getElementById("shortUrl").innerText;
        window.open(shortUrl, '_blank');
    }
</script>
</body>
</html>
